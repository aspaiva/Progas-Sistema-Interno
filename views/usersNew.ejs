<%- include("_head.ejs") %>

    <body class="container">
        <%- include("_siteNavigation.ejs") %>
            <h3 class="mb-3">Cadastro de novo usuário</h3>
            <form action="/users" method="post">
                <div class="container-fluid p-3 mb-3 rounded-3 shadow">
                    <div class="row mb-3">
                        <div class="col-1">
                            <label class="col-form-label" for="name">Nome</label>
                        </div>
                        <div class="col-4">
                            <input class="form-control" type="text" name="name" placeholder="Nome do usuário" required>
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-1">
                            <label class="col-form-label" for="email">Email</label>
                        </div>
                        <div class="col-4">
                            <input class="form-control" type="email" name="email" placeholder="Email do usuário"
                                required>
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-1">
                            <label for="tags">Tags</label>
                        </div>
                        <div class="col-4">
                            <input class="form-control" type="text" name="tags"
                                placeholder="Palavras-chaves do usuário, separadas por vírgulas">
                        </div>
                    </div>

                    <div class="row mb-3">
                        <div class="col-1">
                            <label for="password">Senha</label>
                        </div>
                        <div class="col-2">
                            <input class="form-control" type="password" name="password" placeholder="informe sua senha">
                        </div>

                        <div class="col-2">
                            <input class="form-control" type="password" id="passwordCheck"
                                placeholder="Repita sua senha para conferir">
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-1">
                            <label for="UF">UF</label>
                        </div>
                        <div class="col-2">
                            <select class="form-select" name="UF" id="UF"></select>
                        </div>
                        <div class="col-1">
                            <label class="col-form-label">
                                <input class="form-check-input" type="checkbox" name="active" value="true"> Ativo
                            </label>
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-1">
                            <label for="role">Papel</label>
                        </div>
                        <div class="col-2">
                            <select class="form-select" name="role" id="role">
                                <option value="0">Consulta</option>
                                <option value="1">Operador</option>
                                <option value="2">Coordenador</option>
                                <option value="9">Administrador</option>
                            </select>
                        </div>
                    </div>
                    <hr>
                    <div class="xbg-light">
                        <div class="row">
                            <div class="form-group">
                                <button class="btn btn-primary" type="submit">Incluir</button>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
            <!-- <div class="p-3">
                <div class="row">
                    <div class="form-group">
                        <a class="btn btn-link" href="/users">Voltar</a>
                        <a class="btn btn-link" href="/">Home</a>
                    </div>
                </div>
            </div> -->
            <script>
                fetch("https://servicodados.ibge.gov.br/api/v1/localidades/estados")
                    .then(response => response.json())
                    .then(dados => {
                        const selector = document.getElementById("UF");
                        const siglas = dados.map(item => `${item.sigla} - ${item.nome}`);
                        siglas.sort();

                        siglas.forEach(element => {
                            const opt = document.createElement("option");
                            opt.innerText = element; //exibe UF - Nome do estado para facilitar pros usuários a escolha da UF sem erros
                            opt.value = element.split('-')[0].trim(); //pega somente a sigla para o value
                            selector.append(opt);
                        });
                    })
                    .catch(error => { alert(error); return; });

                document.querySelector('input[name="active"]').checked = true; // Marcar o checkbox como ativo por padrão

                document.querySelector('form').addEventListener('submit', function (event) {
                    const senha = document.querySelector('input[name="password"]').value;
                    const senhaCheck = document.querySelector('input[id="passwordCheck"]').value;
                    if (senha !== senhaCheck) {
                        alert('As senhas não conferem. Por favor, digite senhas iguais.');
                        event.preventDefault(); // Impede o envio do formulário
                        return false;
                    }
                    // Se quiser validar outros campos, adicione aqui
                });

                if (window.location.search.includes('error')) {
                    alert('Erro ao incluir usuário. Verifique os dados e tente novamente.');
                }
            </script>


    </body>
    <%- include("_footer.ejs") %>

</html>